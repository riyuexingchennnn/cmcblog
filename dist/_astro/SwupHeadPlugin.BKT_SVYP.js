import{e as O}from"./index.modern.CkIAsQri.js";function y(){return y=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},y.apply(this,arguments)}function T(r){return r.localName!=="title"&&!r.matches("[data-swup-theme]")}function A(r,n){return r.outerHTML===n.outerHTML}function P(r,n=[]){const t=Array.from(r.attributes);return n.length?t.filter(({name:i})=>n.some(h=>h instanceof RegExp?h.test(i):i===h)):t}function j(r){return r.matches("link[rel=stylesheet][href]")}class k extends O{constructor(n={}){var t;super(),t=this,this.name="SwupHeadPlugin",this.requires={swup:">=4.6"},this.defaults={persistTags:!1,persistAssets:!1,awaitAssets:!1,attributes:["lang","dir"],timeout:3e3},this.options=void 0,this.updateHead=async function(i,{page:{}}){const{awaitAssets:h,attributes:v,timeout:x}=t.options,w=i.to.document,{removed:E,added:b}=function(s,m,{shouldPersist:c=()=>!1}={}){const u=Array.from(s.children),o=Array.from(m.children),l=(f=u,o.reduce((e,d,p)=>(f.some(g=>A(d,g))||e.push({el:d,index:p}),e),[]));var f;const a=function(e,d){return e.reduce((p,g)=>(d.some(H=>A(g,H))||p.push({el:g}),p),[])}(u,o);return a.reverse().filter(({el:e})=>T(e)).filter(({el:e})=>!c(e)).forEach(({el:e})=>s.removeChild(e)),l.filter(({el:e})=>T(e)).forEach(({el:e,index:d=0})=>{s.insertBefore(e.cloneNode(!0),s.children[d+1]||null)}),{removed:a.map(({el:e})=>e),added:l.map(({el:e})=>e)}}(document.head,w.head,{shouldPersist:s=>t.isPersistentTag(s)});if(t.swup.log(`Removed ${E.length} / added ${b.length} tags in head`),v!=null&&v.length&&function(s,m,c=[]){const u=new Set;for(const{name:o,value:l}of P(m,c))s.setAttribute(o,l),u.add(o);for(const{name:o}of P(s,c))u.has(o)||s.removeAttribute(o)}(document.documentElement,w.documentElement,v),h){const s=function(m,c=0){return m.filter(j).map(u=>function(o,l=0){const f=a=>{o.sheet?a():setTimeout(()=>f(a),10)};return new Promise(a=>{f(()=>a(o)),l>0&&setTimeout(()=>a(o),l)})}(u,c))}(b,x);s.length&&(t.swup.log(`Waiting for ${s.length} assets to load`),await Promise.all(s))}},this.options=y({},this.defaults,n),this.options.persistAssets&&!this.options.persistTags&&(this.options.persistTags="link[rel=stylesheet], script[src], style")}mount(){this.before("content:replace",this.updateHead)}isPersistentTag(n){const{persistTags:t}=this.options;return typeof t=="function"?t(n):typeof t=="string"&&t.length>0?n.matches(t):!!t}}export{k as default};
